<ion-header>
  <ion-navbar color='primary'>
    <ion-buttons>
      <button  float-left ion-button icon-only menuToggle>
        <ion-icon name="menu"></ion-icon>
      </button>
    </ion-buttons>
    <!-- <ion-toolbar>
    
    
        <div float-left id="search_icon_bg">
            <ion-icon name="search" id="search_icon"></ion-icon>
        </div>
    
        
        <input 
        style="margin:0em;"
          float-left placeholder="search" 
          autocorrect="off" 
          autocapitalize="off" 
          spellcheck="off" 
          type="text" 
          class="form-control" 
          #search
          value="" 
          [formControl]="searchControl"
          id="search_bar"
        >
    
        
        <ion-buttons end style="background: white">
          
            <button (click)="openFilterModal()" ion-button clear icon-only outline style="margin-left:4px">
                <ion-icon name="funnel"></ion-icon>
              </button>
              <button (click)="resetMap()" ion-button clear icon-only outline>
                  <ion-icon name="pin"></ion-icon>
                </button>
        </ion-buttons>
        
      
      </ion-toolbar> -->
  </ion-navbar>  
  
</ion-header>

<div 
style="width: 100%; height: 40px; background:white; border-bottom: 1px solid grey; position: absolute; top:56px; z-index: 5000;">
  <div float-left id="search_icon_bg">
      <ion-icon name="search" id="search_icon"></ion-icon>
  </div>
  <input  
    float-left placeholder="search" 
    autocorrect="off" 
    autocapitalize="off" 
    spellcheck="off" 
    type="text" 
    class="form-control" 
    #search
    value="" 
    [formControl]="searchControl"
    id="search_bar"
    style="margin:0em; width: 50%; height:38px;"
  >
        
  <button 
    float-right 
    (click)="openFilterModal()" 
    ion-button 
    clear 
    icon-only 
    style="margin-left:4px">
      <ion-icon name="funnel"></ion-icon>
  </button>
  <button 
    float-right 
    (click)="resetMap()" 
    ion-button 
    clear 
    icon-only>
      <ion-icon name="pin"></ion-icon>
  </button>
    
</div>

<ion-content id="content">
  <agm-map 
    [latitude]="mapCenterLat" 
    [longitude]="mapCenterLng" id="map" 
    [zoom]="15" 
    [styles]="styles"
    [streetViewControl]="false"
    [zoomControl]="false"
    (centerChange)="trackCenter($event)"
    (idle) = "setNewCenter()"
    #map
    (mapClick)="mapClick()"
  >

  <agm-snazzy-info-window
    [isOpen]="markerOpen" 
    [latitude]="markerLat" 
    [longitude]="markerLong" 
    [wrapperClass]="'cz-info-window-container'"
    [maxWidth]="375"
    [maxHeight]= "375"
    [pointer]="'10px'"
    [openOnMarkerClick]="true"
    [closeWhenOthersOpen]="true"
    [showCloseButton]="false"
    [borderRadius]="'10px'"
    (beforeOpen)="infoWindowOpening()"
    [backgroundColor]="'#FFF'"
    [padding]="'4px'"
    >   
    <ng-template>
      <div style="width: 250px; position:relative; height:auto; margin-top: 0px;    margin-bottom:4px; padding:0px;">
       
        <img width="100%" src="{{item.data.logo}}" alt="logo">
            
        <div text-center><strong>{{item.data.name}}</strong></div>
        <ion-grid>
          <ion-row>
            <ion-col>
                <div text-center>{{item.data.currentDeal.dealDesc}}</div>
            </ion-col>   
          </ion-row>
          <ion-row>
            <ion-col>
              <button (click)="openModal(item)" ion-button full>Details</button>
            </ion-col>
          </ion-row>
        </ion-grid>
      </div> 
  </ng-template>
    </agm-snazzy-info-window>

    <!-- current location (blinking dot) -->
    <!-- chnage this so that lat ad long are not the same as map center -->
    <agm-marker 
      [latitude]="currentLocLat" 
      [longitude]="currentLocLng" 
      [iconUrl]="icon" 
      [markerClickable]="true"     
    >
    </agm-marker>

    <div *ngFor="let item of rests | async; let i = index">
      <div *ngIf="checkCurrentDeal(item)">
        <agm-marker
          [latitude]="item.data.lat" 
          [longitude]="item.data.long"
          [iconUrl]="item.data.customMarker"
          #marker
          (markerClick) = "getMarkerInfo(item)"
        ></agm-marker>
      </div>
      <div *ngIf="!checkCurrentDeal(item)">
          <agm-marker 
            [latitude]="item.data.lat" 
            [longitude]="item.data.long"
            [iconUrl]="item.data.customMarkerExp"
            #marker
            (markerClick) = "getMarkerInfo(item)"
          ></agm-marker>
        </div>
      
      
    </div>
    
   
    
  </agm-map>
</ion-content>